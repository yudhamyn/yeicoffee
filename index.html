<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Yei Coffee - Penjualan & Pengeluaran</title>
  <style>
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      background: #fffaf0;
      text-align: center;
      padding: 10px;
    }

    h1 {
      color: #5a381e;
      margin: 15px 0;
      font-size: 1.5em;
    }

    .menu-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
      margin-bottom: 20px;
    }

    button {
      background-color: #8b5e3c;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.12s;
      font-size: 14px;
    }

    button:hover {
      background-color: #6d4329;
      transform: translateY(-2px);
    }

    table {
      width: 100%;
      max-width: 800px;
      margin: auto;
      border-collapse: collapse;
      background-color: white;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      font-size: 14px;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
    }

    th {
      background-color: #ffeaa7;
      color: #3e2723;
    }

    td[contenteditable="true"] {
      background-color: #f9f9f9;
      cursor: text;
    }

    .totals-row {
      font-weight: bold;
      background-color: #fff3cd;
    }

    #popup, #overlay {
      display: none;
      position: fixed;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      z-index: 10;
    }

    #popup {
      background: white;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.3);
      width: 90%;
      max-width: 320px;
    }

    #overlay {
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.4);
      z-index: 5;
    }

    #popup select, #popup input {
      margin: 8px 0;
      padding: 8px;
      width: 90%;
    }

    #popup button {
      width: 45%;
      margin: 5px;
      background-color: #6f4e37;
      border-radius: 6px;
      color: white;
    }

    .rekap-total {
      max-width: 800px;
      margin: 20px auto;
      background: #fff3e0;
      padding: 12px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      text-align: left;
      line-height: 1.8;
    }

    .pengeluaran-form {
      margin-top: 20px;
      padding: 10px;
      background: #ffe0b2;
      border-radius: 10px;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
    }

    .pengeluaran-form input {
      padding: 8px;
      margin: 5px;
      font-size: 14px;
      width: 45%;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    .pengeluaran-table {
      margin-top: 15px;
      width: 100%;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
      border-collapse: collapse;
      background: #fff;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      font-size: 14px;
    }

    .pengeluaran-table th {
      background: #ffcc80;
    }

    @media (max-width: 600px) {
      table {
        font-size: 12px;
      }
      button {
        flex: 1 1 45%;
        font-size: 13px;
        padding: 8px;
      }
      .pengeluaran-form input {
        width: 90%;
      }
      .rekap-total {
        font-size: 13px;
      }
    }
  </style>
</head>
<body>
  <h1>Yei Coffee - Penjualan & Pengeluaran</h1>
  <div class="menu-container" id="menuContainer"></div>

  <!-- Popup -->
  <div id="overlay"></div>
  <div id="popup">
    <h3 id="popup-title"></h3>
    <label>Jumlah:</label><br />
    <input type="number" id="jumlahInput" min="1" value="1" /><br />
    <label>Metode Pembayaran:</label><br />
    <select id="metodeSelect">
      <option value="Cash">Cash</option>
      <option value="QRIS">QRIS</option>
    </select><br />
    <div>
      <button onclick="tambahTransaksi()">Tambah</button>
      <button onclick="tutupPopup()">Batal</button>
    </div>
  </div>

  <!-- Tabel Penjualan -->
  <table id="rekapTable">
    <thead>
      <tr>
        <th>No</th><th>Menu</th><th>Jumlah Cash</th><th>Total Cash</th>
        <th>Jumlah QRIS</th><th>Total QRIS</th>
      </tr>
    </thead>
    <tbody></tbody>
    <tfoot>
      <tr class="totals-row">
        <td colspan="2">Grand Total</td>
        <td id="grand-jumlah-cash">0</td><td id="grand-total-cash">0</td>
        <td id="grand-jumlah-qris">0</td><td id="grand-total-qris">0</td>
      </tr>
    </tfoot>
  </table>

  <!-- Input Modal -->
  <div class="pengeluaran-form">
    <h3>Modal Awal</h3>
    <input type="number" id="uangModal" placeholder="Masukkan uang modal (Rp)" />
    <button onclick="simpanModal()">Simpan Modal</button>
  </div>

  <!-- Pengeluaran -->
  <div class="pengeluaran-form">
    <h3>Catat Pengeluaran</h3>
    <input type="text" id="namaPengeluaran" placeholder="Nama Pengeluaran" />
    <input type="number" id="jumlahPengeluaran" placeholder="Jumlah (Rp)" />
    <button onclick="tambahPengeluaran()">Tambah</button>
  </div>

  <table class="pengeluaran-table" id="tabelPengeluaran">
    <thead><tr><th>No</th><th>Nama</th><th>Jumlah (Rp)</th><th>Aksi</th></tr></thead>
    <tbody></tbody>
  </table>

  <!-- Rekap -->
  <div class="rekap-total" id="rekapTotal">
    <h3>Rekap Total Keseluruhan</h3>
    <p>Modal Awal: <b id="modalAwalRp">Rp 0</b></p>
    <p>Total Cash: <b id="totalCashRp">Rp 0</b></p>
    <p>Total QRIS: <b id="totalQrisRp">Rp 0</b></p>
    <p>Total Pengeluaran: <b id="totalKeluarRp">Rp 0</b></p>
    <hr />
    <p><b>Total Bersih: <span id="totalBersihRp" style="color:green">Rp 0</span></b></p>
    <hr />
    <button style="background:#b71c1c" onclick="resetSemua()">üîÑ Reset Semua Data</button>
  </div>

  <script>
    const menuList = {
      "Yei Coffee": 13000, "Cafe Latte": 8000, "Gula Aren": 10000,
      "Popcorn Latte": 12000, "Matcha": 13000, "Choco Hazel": 13000,
      "Americano": 8000, "Blush Berry": 13000, "Pink Potion": 13000,
      "Thai Tea": 13000, "Spanish Latte": 12000, "Butterscotch Latte": 15000,
      "Espresso": 3000,
    };

    let dataRekap = JSON.parse(localStorage.getItem("dataRekap") || "[]");
    let pengeluaran = JSON.parse(localStorage.getItem("pengeluaran") || "[]");
    let uangModal = parseInt(localStorage.getItem("uangModal") || "0");

    const menuContainer = document.getElementById("menuContainer");
    const rekapTableBody = document.querySelector("#rekapTable tbody");
    const tabelPengeluaran = document.querySelector("#tabelPengeluaran tbody");

    Object.keys(menuList).forEach((menu) => {
      const btn = document.createElement("button");
      btn.textContent = menu;
      btn.onclick = () => bukaPopup(menu);
      menuContainer.appendChild(btn);
    });

    function simpanLocal() {
      localStorage.setItem("dataRekap", JSON.stringify(dataRekap));
      localStorage.setItem("pengeluaran", JSON.stringify(pengeluaran));
      localStorage.setItem("uangModal", uangModal);
    }

    function bukaPopup(menu) {
      document.getElementById("popup-title").innerText = menu;
      document.getElementById("jumlahInput").value = 1;
      document.getElementById("overlay").style.display = "block";
      document.getElementById("popup").style.display = "block";
      window.menuDipilih = menu;
    }

    function tutupPopup() {
      document.getElementById("popup").style.display = "none";
      document.getElementById("overlay").style.display = "none";
    }

    function tambahTransaksi() {
      const jumlah = parseInt(document.getElementById("jumlahInput").value);
      const metode = document.getElementById("metodeSelect").value;
      if (!jumlah) return;
      let existing = dataRekap.find(r => r.menu === menuDipilih);
      if (!existing) {
        existing = { menu: menuDipilih, jumlahCash:0, totalCash:0, jumlahQris:0, totalQris:0 };
        dataRekap.push(existing);
      }
      if (metode === "Cash") {
        existing.jumlahCash += jumlah;
        existing.totalCash = existing.jumlahCash * menuList[menuDipilih];
      } else {
        existing.jumlahQris += jumlah;
        existing.totalQris = existing.jumlahQris * menuList[menuDipilih];
      }
      renderTable(); updateTotals(); simpanLocal(); tutupPopup();
    }

    function renderTable() {
      rekapTableBody.innerHTML = "";
      dataRekap.forEach((r, i) => {
        const row = `<tr>
          <td>${i+1}</td><td>${r.menu}</td>
          <td contenteditable="true" data-i="${i}" data-t="cash">${r.jumlahCash}</td>
          <td>${r.totalCash.toLocaleString("id-ID")}</td>
          <td contenteditable="true" data-i="${i}" data-t="qris">${r.jumlahQris}</td>
          <td>${r.totalQris.toLocaleString("id-ID")}</td>
        </tr>`;
        rekapTableBody.insertAdjacentHTML("beforeend", row);
      });
      document.querySelectorAll('td[contenteditable="true"]').forEach(cell=>{
        cell.onblur=e=>{
          const i=e.target.dataset.i, t=e.target.dataset.t, v=parseInt(e.target.textContent)||0;
          if(t==="cash"){dataRekap[i].jumlahCash=v;dataRekap[i].totalCash=v*menuList[dataRekap[i].menu];}
          else{dataRekap[i].jumlahQris=v;dataRekap[i].totalQris=v*menuList[dataRekap[i].menu];}
          renderTable();updateTotals();simpanLocal();
        };
      });
    }

    function tambahPengeluaran() {
      const nama=document.getElementById("namaPengeluaran").value.trim();
      const jumlah=parseInt(document.getElementById("jumlahPengeluaran").value);
      if(!nama||!jumlah)return;
      pengeluaran.push({nama,jumlah});
      document.getElementById("namaPengeluaran").value="";
      document.getElementById("jumlahPengeluaran").value="";
      renderPengeluaran();updateTotals();simpanLocal();
    }

    function renderPengeluaran() {
      tabelPengeluaran.innerHTML="";
      pengeluaran.forEach((p,i)=>{
        tabelPengeluaran.insertAdjacentHTML("beforeend",
          `<tr><td>${i+1}</td>
          <td contenteditable="true" data-i="${i}" data-f="nama">${p.nama}</td>
          <td contenteditable="true" data-i="${i}" data-f="jumlah">${p.jumlah}</td>
          <td><button onclick="hapusPengeluaran(${i})">‚ùå</button></td></tr>`);
      });
      document.querySelectorAll('#tabelPengeluaran td[contenteditable="true"]').forEach(c=>{
        c.onblur=e=>{
          const i=c.dataset.i,f=c.dataset.f;
          if(f==="jumlah"){pengeluaran[i].jumlah=parseInt(c.textContent)||0;}
          else pengeluaran[i].nama=c.textContent.trim();
          updateTotals();simpanLocal();
        };
      });
    }

    function hapusPengeluaran(i){pengeluaran.splice(i,1);renderPengeluaran();updateTotals();simpanLocal();}

    function simpanModal(){
      uangModal=parseInt(document.getElementById("uangModal").value)||0;
      simpanLocal();updateTotals();
    }

    function updateTotals() {
      let jC=0,tC=0,jQ=0,tQ=0;
      dataRekap.forEach(r=>{jC+=r.jumlahCash;tC+=r.totalCash;jQ+=r.jumlahQris;tQ+=r.totalQris;});
      document.getElementById("grand-jumlah-cash").textContent=jC;
      document.getElementById("grand-total-cash").textContent=tC.toLocaleString("id-ID");
      document.getElementById("grand-jumlah-qris").textContent=jQ;
      document.getElementById("grand-total-qris").textContent=tQ.toLocaleString("id-ID");

      const totalKeluar=pengeluaran.reduce((a,b)=>a+b.jumlah,0);
      const totalBersih=tC+tQ-totalKeluar+uangModal;

      document.getElementById("modalAwalRp").textContent=`Rp ${uangModal.toLocaleString("id-ID")}`;
      document.getElementById("totalCashRp").textContent=`Rp ${tC.toLocaleString("id-ID")}`;
      document.getElementById("totalQrisRp").textContent=`Rp ${tQ.toLocaleString("id-ID")}`;
      document.getElementById("totalKeluarRp").textContent=`Rp ${totalKeluar.toLocaleString("id-ID")}`;
      document.getElementById("totalBersihRp").textContent=`Rp ${totalBersih.toLocaleString("id-ID")}`;
    }

    function resetSemua() {
      if (confirm("Yakin ingin mereset semua data?")) {
        localStorage.clear();
        dataRekap = [];
        pengeluaran = [];
        uangModal = 0;
        renderTable(); renderPengeluaran(); updateTotals();
        document.getElementById("uangModal").value = "";
      }
    }

    // Muat ulang data
    renderTable(); renderPengeluaran(); updateTotals();
    document.getElementById("uangModal").value = uangModal;
  </script>
</body>
</html>



<!-- Tombol menuju kalkulator -->
<div style="text-align:center; margin-top:15px;">
  <button style="background:#6f4e37;" onclick="window.location.href='kalkulator.html'">
    ‚òï Buka Kalkulator Pembelian
  </button>
</div>
