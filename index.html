<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Yei Coffee - Penjualan & Pengeluaran</title>
<style>
body {
  font-family: "Segoe UI", Arial, sans-serif;
  background: #fffaf0;
  text-align: center;
  padding: 10px;
  margin:0;
}

h1 {
  color: #5a381e;
  margin: 15px 0;
  font-size: 1.5em;
}

.menu-container {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 8px;
  margin-bottom: 20px;
}

button {
  background-color: #8b5e3c;
  color: white;
  border: none;
  padding: 10px 15px;
  border-radius: 8px;
  cursor: pointer;
  transition: 0.12s;
  font-size: 14px;
}

button:hover { background-color: #6d4329; transform: translateY(-2px); }

table {
  width: 100%;
  max-width: 800px;
  margin: auto;
  border-collapse: collapse;
  background-color: white;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  font-size: 14px;
}

th, td {
  border: 1px solid #ddd;
  padding: 8px;
  text-align: center;
}

th {
  background-color: #ffeaa7;
  color: #3e2723;
}

td[contenteditable="true"] {
  background-color: #f9f9f9;
  cursor: text;
}

.totals-row { font-weight: bold; background-color: #fff3cd; }

/* Popup */
#overlay {
  display:none;
  position: fixed;
  top:0; left:0;
  width:100%; height:100%;
  background: rgba(0,0,0,0.5);
  z-index: 100;
}
#popup {
  display:none;
  position: fixed;
  top:50%; left:50%;
  transform: translate(-50%,-50%);
  background:#fff;
  padding:20px;
  border-radius:16px;
  box-shadow:0 4px 10px rgba(0,0,0,0.3);
  width:90%;
  max-width:350px;
  z-index:101;
  text-align:center;
}
#jumlahInput {
  width:100%;
  text-align:center;
  font-size:1.5em;
  margin:10px 0;
  padding:10px;
  border-radius:8px;
  border:2px solid #ddd;
}

.keypad {
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:8px;
  margin-top:5px;
}
.key {
  background:#725e03;
  border:none;
  border-radius:10px;
  padding:15px;
  font-size:1.2em;
  font-weight:bold;
  cursor:pointer;
  transition:0.2s;
}
.key:hover { background:#0da6e8; }

.method-buttons { margin-top:10px; }
.method {
  background:#674207;
  border:none;
  border-radius:8px;
  padding:10px 20px;
  margin:5px;
  cursor:pointer;
  font-weight:bold;
  transition:all 0.3s;
}
.method.active { background:#4CAF50; color:rgb(117,92,2); }

.rekap-total, .pengeluaran-form {
  max-width:800px;
  margin:20px auto;
  margin-inline-start: 10px;
  background:#fff3e0;
  padding:12px;
  border-radius:10px;
  box-shadow:0 2px 6px rgba(0,0,0,0.1);
  text-align:left;
  line-height:1.8;
}
.rekap-total button {
  display:inline-block;
  align-content: center;
  margin:10px auto 0 auto;
}
.pengeluaran-form { background:#ffe0b2; }

.pengeluaran-form input {
  padding:8px;
  margin:5px;
  font-size:14px;
  width:45%;
  border-radius:6px;
  border:1px solid #ccc;
}
.pengeluaran-form button {
  display:inline-block;
  margin:10px auto 0 auto;
}


.pengeluaran-table {
  margin-top:15px;
  width:100%;
  max-width:800px;
  margin-left:auto;
  margin-right:auto;
  border-collapse:collapse;
  background:#fff;
  box-shadow:0 2px 6px rgba(0,0,0,0.1);
  font-size:14px;
}
.pengeluaran-table th { background:#ffcc80; }

@media (max-width:600px){
  table { font-size:12px; }
  button { flex:1 1 45%; font-size:13px; padding:8px; }
  .pengeluaran-form input { width:90%; }
  .rekap-total { font-size:13px; }
}
</style>
</head>
<body>

<h1>Yei Coffee - Penjualan & Pengeluaran</h1>

<div class="menu-container" id="menuContainer"></div>

<!-- Popup -->
<div id="overlay"></div>
<div id="popup">
  <h3 id="popupTitle">Masukkan Jumlah</h3>
  <button onclick="closePopup()" style="position:absolute; top:10px; right:10px; background:#b71c1c; color:white; border:none; border-radius:50%; width:30px; height:30px; cursor:pointer;">‚úñ</button>

  <div class="method-buttons">
    <button class="method" id="cashBtn" onclick="selectMethod('Cash')">üíµ Cash</button>
    <button class="method" id="qrisBtn" onclick="selectMethod('QRIS')">üì± QRIS</button>
  </div>

  <input type="text" id="jumlahInput" value="0" readonly>

  <div class="keypad">
    <button class="key" onclick="addDigit(1)">1</button>
    <button class="key" onclick="addDigit(2)">2</button>
    <button class="key" onclick="addDigit(3)">3</button>
    <button class="key" onclick="addDigit(4)">4</button>
    <button class="key" onclick="addDigit(5)">5</button>
    <button class="key" onclick="addDigit(6)">6</button>
    <button class="key" onclick="addDigit(7)">7</button>
    <button class="key" onclick="addDigit(8)">8</button>
    <button class="key" onclick="addDigit(9)">9</button>
    <button class="key" onclick="clearInput()">‚å´</button>
    <button class="key" onclick="addDigit(0)">0</button>
    <button class="key" onclick="okInput()">‚úî</button>
  </div>
</div>


<!-- Tabel Penjualan -->
<table id="rekapTable">
<thead>
<tr>
<th>No</th><th>Menu</th><th>Jumlah Cash</th><th>Total Cash</th>
<th>Jumlah QRIS</th><th>Total QRIS</th>
</tr>
</thead>
<tbody></tbody>
<tfoot>
<tr class="totals-row">
<td colspan="2">Grand Total</td>
<td id="grand-jumlah-cash">0</td><td id="grand-total-cash">0</td>
<td id="grand-jumlah-qris">0</td><td id="grand-total-qris">0</td>
</tr>
</tfoot>
</table>

<!-- Modal Awal -->
<div class="pengeluaran-form">
  <h3>Modal Awal</h3>
  <input type="number" id="uangModal" placeholder="Masukkan uang modal (Rp)">
  <div style="text-align:center; margin-top:8px;">
    <button onclick="simpanModal()">Simpan Modal</button>
  </div>
</div>

<!-- Pengeluaran -->
<div class="pengeluaran-form">
  <h3>Catat Pengeluaran</h3>
  <input type="text" id="namaPengeluaran" placeholder="Nama Pengeluaran">
  <input type="number" id="jumlahPengeluaran" placeholder="Jumlah (Rp)">
  <div style="text-align:center; margin-top:8px;">
    <button onclick="tambahPengeluaran()">Tambah</button>
  </div>
</div>


<table class="pengeluaran-table" id="tabelPengeluaran">
<thead><tr><th>No</th><th>Nama</th><th>Jumlah (Rp)</th><th>Aksi</th></tr></thead>
<tbody></tbody>
</table>

<!-- Rekap Total -->
<div class="rekap-total" id="rekapTotal">
<h3>Rekap Total Keseluruhan</h3>
<p>Modal Awal: <b id="modalAwalRp">Rp 0</b></p>
<p>Total Cash: <b id="totalCashRp">Rp 0</b></p>
<p>Total QRIS: <b id="totalQrisRp">Rp 0</b></p>
<p>Total Pengeluaran: <b id="totalKeluarRp">Rp 0</b></p>
<hr>
<p><b>Total Bersih: <span id="totalBersihRp" style="color:green">Rp 0</span></b></p>
<hr>
<button style="background:#b71c1c" onclick="resetSemua()">üîÑ Reset Semua Data</button>
</div>

<div style="text-align:center; margin-top:15px;">
<button style="background:#6f4e37;" onclick="window.location.href='kalkulator.html'">
‚òï Buka Kalkulator Pembelian
</button>
</div>

<script>
const menuList = {
  "Yei Coffee":13000,"Cafe Latte":8000,"Gula Aren":10000,"Popcorn Latte":12000,
  "Matcha":13000,"Choco Hazel":13000,"Americano":8000,"Blush Berry":13000,
  "Pink Potion":13000,"Thai Tea":13000,"Spanish Latte":12000,
  "Butterscotch Latte":15000,"Espresso":3000
};
let dataRekap=JSON.parse(localStorage.getItem("dataRekap")||"[]");
let pengeluaran=JSON.parse(localStorage.getItem("pengeluaran")||"[]");
let uangModal=parseInt(localStorage.getItem("uangModal")||"0");
let menuDipilih=null, selectedMethod=null;

const menuContainer=document.getElementById("menuContainer");
const rekapTableBody=document.querySelector("#rekapTable tbody");
const tabelPengeluaran=document.querySelector("#tabelPengeluaran tbody");

// Generate tombol menu
Object.keys(menuList).forEach(menu=>{
  const btn=document.createElement("button");
  btn.textContent=menu;
  btn.onclick=()=>openPopup(menu);
  menuContainer.appendChild(btn);
});

// Popup Functions
function addDigit(n){const input=document.getElementById("jumlahInput");input.value=(input.value==="0"?n:input.value+n);}
function clearInput(){const input=document.getElementById("jumlahInput");input.value=input.value.slice(0,-1)||"0";}
function selectMethod(m){selectedMethod=m;document.getElementById("cashBtn").classList.toggle("active",m==="Cash");document.getElementById("qrisBtn").classList.toggle("active",m==="QRIS");}
function okInput(){if(!selectedMethod){alert("Pilih metode pembayaran");return;}tambahTransaksi();closePopup();}
function openPopup(menu){menuDipilih=menu;document.getElementById("popupTitle").innerText=menu;document.getElementById("jumlahInput").value="0";document.getElementById("overlay").style.display="block";document.getElementById("popup").style.display="block";}
function closePopup(){document.getElementById("popup").style.display="none";document.getElementById("overlay").style.display="none";selectedMethod=null;document.querySelectorAll(".method").forEach(b=>b.classList.remove("active"));}
function tambahTransaksi(){
  const jumlah=parseInt(document.getElementById("jumlahInput").value);
  if(!jumlah) return;
  let r=dataRekap.find(x=>x.menu===menuDipilih);
  if(!r){r={menu:menuDipilih,jumlahCash:0,totalCash:0,jumlahQris:0,totalQris:0};dataRekap.push(r);}
  if(selectedMethod==="Cash"){r.jumlahCash+=jumlah;r.totalCash=r.jumlahCash*menuList[menuDipilih];}
  else{r.jumlahQris+=jumlah;r.totalQris=r.jumlahQris*menuList[menuDipilih];}
  renderTable(); updateTotals(); simpanLocal();
}

// Render Functions
function renderTable(){
  rekapTableBody.innerHTML="";
  dataRekap.forEach((r,i)=>{
    rekapTableBody.insertAdjacentHTML("beforeend",
      `<tr><td>${i+1}</td><td>${r.menu}</td>
      <td contenteditable="true" data-i="${i}" data-t="cash">${r.jumlahCash}</td>
      <td>${r.totalCash.toLocaleString("id-ID")}</td>
      <td contenteditable="true" data-i="${i}" data-t="qris">${r.jumlahQris}</td>
      <td>${r.totalQris.toLocaleString("id-ID")}</td></tr>`);
  });
  document.querySelectorAll('td[contenteditable="true"]').forEach(c=>{
    c.onblur=e=>{
      const i=c.dataset.i,t=c.dataset.t,v=parseInt(c.textContent)||0;
      if(t==="cash"){dataRekap[i].jumlahCash=v;dataRekap[i].totalCash=v*menuList[dataRekap[i].menu];}
      else{dataRekap[i].jumlahQris=v;dataRekap[i].totalQris=v*menuList[dataRekap[i].menu];}
      renderTable();updateTotals();simpanLocal();
    };
  });
}

function tambahPengeluaran(){
  const n=document.getElementById("namaPengeluaran").value.trim();
  const j=parseInt(document.getElementById("jumlahPengeluaran").value);
  if(!n||!j)return;
  pengeluaran.push({nama:n,jumlah:j});
  document.getElementById("namaPengeluaran").value="";
  document.getElementById("jumlahPengeluaran").value="";
  renderPengeluaran();updateTotals();simpanLocal();
}
function renderPengeluaran(){
  tabelPengeluaran.innerHTML="";
  pengeluaran.forEach((p,i)=>{
    tabelPengeluaran.insertAdjacentHTML("beforeend",
      `<tr><td>${i+1}</td>
      <td contenteditable data-i="${i}" data-f="nama">${p.nama}</td>
      <td contenteditable data-i="${i}" data-f="jumlah">${p.jumlah}</td>
      <td><button onclick="hapusPengeluaran(${i})">‚ùå</button></td></tr>`);
  });
  document.querySelectorAll('#tabelPengeluaran td[contenteditable]').forEach(c=>{
    c.onblur=e=>{
      const i=c.dataset.i,f=c.dataset.f;
      if(f==="jumlah"){pengeluaran[i].jumlah=parseInt(c.textContent)||0;}
      else pengeluaran[i].nama=c.textContent.trim();
      updateTotals();simpanLocal();
    };
  });
}
function hapusPengeluaran(i){pengeluaran.splice(i,1);renderPengeluaran();updateTotals();simpanLocal();}
function simpanModal(){uangModal=parseInt(document.getElementById("uangModal").value)||0;simpanLocal();updateTotals();}
function updateTotals(){
  let jC=0,tC=0,jQ=0,tQ=0;
  dataRekap.forEach(r=>{jC+=r.jumlahCash;tC+=r.totalCash;jQ+=r.jumlahQris;tQ+=r.totalQris;});
  document.getElementById("grand-jumlah-cash").textContent=jC;
  document.getElementById("grand-total-cash").textContent=tC.toLocaleString("id-ID");
  document.getElementById("grand-jumlah-qris").textContent=jQ;
  document.getElementById("grand-total-qris").textContent=tQ.toLocaleString("id-ID");
  const totalKeluar=pengeluaran.reduce((a,b)=>a+b.jumlah,0);
  const totalBersih=tC+tQ-totalKeluar+uangModal;
  document.getElementById("modalAwalRp").textContent=`Rp ${uangModal.toLocaleString("id-ID")}`;
  document.getElementById("totalCashRp").textContent=`Rp ${tC.toLocaleString("id-ID")}`;
  document.getElementById("totalQrisRp").textContent=`Rp ${tQ.toLocaleString("id-ID")}`;
  document.getElementById("totalKeluarRp").textContent=`Rp ${totalKeluar.toLocaleString("id-ID")}`;
  document.getElementById("totalBersihRp").textContent=`Rp ${totalBersih.toLocaleString("id-ID")}`;
}
function resetSemua(){if(confirm("Yakin ingin mereset semua data?")){localStorage.clear();dataRekap=[];pengeluaran=[];uangModal=0;renderTable();renderPengeluaran();updateTotals();document.getElementById("uangModal").value="";}}
function simpanLocal(){localStorage.setItem("dataRekap",JSON.stringify(dataRekap));localStorage.setItem("pengeluaran",JSON.stringify(pengeluaran));localStorage.setItem("uangModal",uangModal);}

// Load data
renderTable();renderPengeluaran();updateTotals();
document.getElementById("uangModal").value=uangModal;
</script>
</body>
</html>
